<section class="space-y-6">
  <header class="flex items-center justify-between gap-4">
    <h1 class="text-2xl font-semibold text-slate-900">Products</h1>

    <div class="flex items-center gap-2">
      <button
        mat-icon-button
        type="button"
        class="border border-slate-200 bg-white"
        (click)="productService.loadAll()"
        [disabled]="isLoading()"
        aria-label="Reload products"
      >
        <mat-icon>refresh</mat-icon>
      </button>

      <button
        mat-icon-button
        color="primary"
        type="button"
        [routerLink]="createLink"
        aria-label="Create product"
        *appHasRole="UserRole.Admin"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </header>

  @if (isLoading()) {
    <div class="flex justify-center py-12">
      <mat-spinner diameter="40" />
    </div>
  } @else {
    @if (error()) {
      <p
        class="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-800"
        role="alert"
      >
        {{ error() }}
      </p>
    }

    @if (products()?.length === 0) {
      <p class="text-sm text-slate-600">No products found.</p>
    } @else if (products()?.length) {
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        @for (product of products(); track product.id) {
          <mat-card class="flex h-full flex-col">
            <img
              [src]="product.image"
              [alt]="product.name"
              class="h-40 w-full rounded-t-md object-cover"
              loading="lazy"
            />

            <mat-card-header class="flex items-start justify-between gap-2">
              <mat-card-title class="text-base font-semibold">
                {{ product.name }}
              </mat-card-title>
              <mat-card-subtitle class="text-xs uppercase tracking-wide text-slate-500">
                {{ product.category }}
              </mat-card-subtitle>

              <div class="ml-auto flex items-center gap-1">
                <button
                  mat-icon-button
                  color="primary"
                  type="button"
                  (click)="onBuy(product.id)"
                  aria-label="Buy product"
                >
                  <mat-icon>shopping_cart</mat-icon>
                </button>

                <button
                  mat-icon-button
                  type="button"
                  [routerLink]="getEditLink(product.id)"
                  aria-label="Edit product"
                  *appHasRole="UserRole.Admin"
                >
                  <mat-icon>edit</mat-icon>
                </button>

                <button
                  mat-icon-button
                  color="warn"
                  type="button"
                  (click)="onDelete(product.id)"
                  aria-label="Delete product"
                  *appHasRole="UserRole.Admin"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-card-header>

            <mat-card-content class="flex flex-1 flex-col gap-2">
              <p class="line-clamp-3 text-sm text-slate-600">
                {{ product.description }}
              </p>

              <p class="mt-auto text-lg font-semibold text-primary-700">
                {{ product.price | currency }}
              </p>
            </mat-card-content>
          </mat-card>
        }
      </div>
    }
  }
</section>
