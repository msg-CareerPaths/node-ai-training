<section class="space-y-6">
  <header class="flex items-center justify-between gap-4">
    <h1 class="text-2xl font-semibold text-slate-900">Reports</h1>

    <div class="flex items-center gap-2">
      <button
        mat-icon-button
        type="button"
        class="border border-slate-200 bg-white"
        (click)="onReload()"
        aria-label="Reload reports"
      >
        <mat-icon>refresh</mat-icon>
      </button>

      <button mat-raised-button color="primary" type="button" [routerLink]="generateLink">
        Generate report
      </button>
    </div>
  </header>

  @if (isLoading()) {
    <div class="flex justify-center py-12">
      <mat-spinner diameter="40" />
    </div>
  } @else {
    @if (error()) {
      <p
        class="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-800"
        role="alert"
      >
        {{ error() }}
      </p>
    }

    @if (!reports() || reports()!.length === 0) {
      <p class="text-sm text-slate-600">No reports generated yet.</p>
    } @else {
      <mat-card class="overflow-x-auto">
        <table mat-table [dataSource]="reports()!" class="min-w-full">
          <ng-container matColumnDef="filename">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-left text-xs font-semibold uppercase tracking-wide text-slate-500"
            >
              File
            </th>
            <td mat-cell *matCellDef="let report" class="text-sm text-slate-800">
              {{ report.filename }}
            </td>
          </ng-container>

          <ng-container matColumnDef="type">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-left text-xs font-semibold uppercase tracking-wide text-slate-500"
            >
              Format
            </th>
            <td mat-cell *matCellDef="let report" class="text-sm text-slate-800">
              {{ report.type }}
            </td>
          </ng-container>

          <ng-container matColumnDef="reportKind">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-left text-xs font-semibold uppercase tracking-wide text-slate-500"
            >
              Kind
            </th>
            <td mat-cell *matCellDef="let report" class="text-sm text-slate-800">
              {{ report.reportKind }}
            </td>
          </ng-container>

          <ng-container matColumnDef="createdAt">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-left text-xs font-semibold uppercase tracking-wide text-slate-500"
            >
              Created at
            </th>
            <td mat-cell *matCellDef="let report" class="text-sm text-slate-800">
              {{ report.createdAt | date: 'short' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-right text-xs font-semibold uppercase tracking-wide text-slate-500"
            >
              Actions
            </th>
            <td mat-cell *matCellDef="let report" class="text-right">
              <button mat-button type="button" (click)="onDownload(report.id, report.filename)">
                Download
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </mat-card>
    }
  }
</section>
